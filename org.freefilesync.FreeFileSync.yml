app-id: org.freefilesync.FreeFileSync

runtime: org.gnome.Platform
runtime-version: '3.36'
sdk: org.gnome.Sdk
command: FreeFileSync

build-options:
  cflags: -O2 -g
  cxxflags: -O2 -g

cleanup:
  - /include
  - /lib/cmake
  - /lib/debug
  - /lib/pkgconfig
  - /share/doc
  - '*.la'
  - '*.a'

finish-args:
  - --share=network
  - --share=ipc                       # X11 needs this
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio               # notification sounds
  - --filesystem=host
  - --filesystem=xdg-run/gvfs         # access gvfs mounts
  - --talk-name=org.gtk.vfs.*         # access gvfs mounts

modules:
  - shared-modules/gtk2/gtk2.json

    # without lsb_release, FFS shows an error at the end of each operation
    # (in the log tab)
  - name: lsb-release-compat
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: git
        url: https://gitlab.com/nanonyme/lsb-release-compat.git
        commit: 5751a93f4cd3885a9c3c92aa86026255851ad670

  - name: freefilesync
    buildsystem: simple
    build-commands:
      - rm -v 'FreeFileSync/User Manual.pdf'
      - mv -v FreeFileSync/ /app/
      - ln -sv "/app/FreeFileSync/Bin/FreeFileSync_$(uname -m)" /app/bin/FreeFileSync
      - ln -sv "/app/FreeFileSync/Bin/RealTimeSync_$(uname -m)" /app/bin/RealTimeSync
      - mkdir -pv /app/share/applications/
      - cp -v *.desktop /app/share/applications/
      - mkdir -pv /app/share/icons/hicolor/128x128/apps/
      - cp -v *.png /app/share/icons/hicolor/128x128/apps/
      - mkdir -pv /app/share/appdata
      - cp -v *.appdata.xml /app/share/appdata
    sources:
      - type: archive
        # the upstream is terrible, the original URL blocks curl/wget without
        # a specific user-agent, we need to use a mirror. Original URL example:
        # https://freefilesync.org/download/FreeFileSync_10.17_Linux.tar.gz
        url: https://kparal.fedorapeople.org/mirror/freefilesync/FreeFileSync_10.23_Linux.tar.gz
        sha256: fa4f8260097357a0307a31ecf78d93de6182255910852b1c101ed033a1de3c74
        strip-components: 0
      - type: file
        path: data/org.freefilesync.FreeFileSync.desktop
      - type: file
        path: data/org.freefilesync.FreeFileSync.png
      - type: file
        path: data/org.freefilesync.FreeFileSync.RealTimeSync.desktop
      - type: file
        path: data/org.freefilesync.FreeFileSync.RealTimeSync.png
      - type: file
        path: data/org.freefilesync.FreeFileSync.appdata.xml
